(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[417],{3516:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/memo",function(){return r(5371)}])},5371:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return H}});var n=r(1527),s=r(5996),i=r(959),l=r(5069),a=r(4127),o=r(943),c=r(3416),u=r(7888),d=r.n(u),m=r(4783),x=r(2693),f=r(6292),h=r(8163),p=r(5398),y=r(881),v=r(293),g=r(5879),j=r(1929);let b=(0,g.U)()((0,v.tJ)((e,t)=>({fontSize:14,setFontSize:t=>{e({fontSize:t})},increaseFontSize:()=>{let{fontSize:r}=t();e({fontSize:r<42?r+4:42})},decreaseFontSize:()=>{let{fontSize:r}=t();e({fontSize:r>10?r-4:10})}}),{name:j.D.fontSize,storage:(0,v.FL)(()=>localStorage)})),z=(0,g.U)()(e=>({memoHistories:[],currentIndex:-1,pushHistory:t=>{e(e=>{let r=[...e.memoHistories,t];return{memoHistories:r,currentIndex:r.length-1}})},backHistory:()=>{e(e=>e.currentIndex>0?{currentIndex:e.currentIndex-1}:e)},nextHistory:()=>{e(e=>e.currentIndex<e.memoHistories.length-1?{currentIndex:e.currentIndex+1}:e)},resetHistory:()=>{e({memoHistories:[],currentIndex:-1})}}));var k=r(5426);function w(e){let{memoId:t,setTitle:r,textareaRef:l}=e,a=(0,s.useRouter)(),{openModal:u,closeModal:v,Modal:g,visible:j}=(0,p.Z)(),{increaseFontSize:w,decreaseFontSize:C,fontSize:N}=b(),{memoHistories:H,currentIndex:Y,backHistory:A,nextHistory:T,resetHistory:I,pushHistory:S}=z();(0,i.useEffect)(()=>{t>0&&I()},[t,I]);let{data:_,isError:D,isLoading:R}=(0,o.a)({queryKey:y.a.memoKeys.detail(t),queryFn:()=>f.n.getMemo(t),enabled:t>0}),[M,E]=(0,i.useState)(""),F=M||(null==_?void 0:_.text)||"";(0,i.useEffect)(()=>{F&&(null==r||r(F.split("\n")[0].slice(0,50)))},[F,r]);let K=(0,c.NL)(),q=(0,i.useRef)(),Z=(0,i.useRef)();function Q(e){E(e),clearTimeout(Z.current),Z.current=setTimeout(async()=>{let r=d()().format("YYYY-MM-DD HH:mm"),n={memoId:t,text:e,editedAt:r,createdAt:(null==_?void 0:_.createdAt)||r};try{await f.n.patchMemo(n),K.invalidateQueries({queryKey:y.a.memoKeys.list()}),K.invalidateQueries({queryKey:y.a.memoKeys.detail(t)}),x.Am.success("수정완료",{duration:500})}catch(e){console.error("메모 수정 실패:",e)}},1500)}let O=_&&d()(_.editedAt||_.createdAt).format("YYYY-MM-DD HH:mm");return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"h-[calc(100dvh-60px-env(safe-area-inset-bottom))] px-[15px] pb-[15px] flex flex-col items-center gap-[10px]",children:D?(0,n.jsx)("div",{className:"text-center",children:"메모 불러오기 실패 \uD83D\uDE25"}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"flex items-center gap-[10px] pt-[10px]",children:[(0,n.jsx)(h.z,{onClick:w,size:"sm",variant:"secondary",children:"글씨+"}),(0,n.jsx)(h.z,{onClick:C,size:"sm",variant:"secondary",children:"글씨-"}),(0,n.jsx)(h.z,{onClick:()=>{A(),E(H[Y-1]),Q(H[Y-1])},size:"sm",variant:"secondary",children:"뒤로"}),(0,n.jsx)(h.z,{onClick:()=>{T(),E(H[Y+1]),Q(H[Y+1])},size:"sm",variant:"secondary",children:"앞으로"})]}),(0,n.jsxs)("div",{className:"relative flex-1 min-h-[250px] w-full min-w-[250px] bg-yellow-50 border-2 border-yellow-300 rounded-lg dark:bg-yellow-900 dark:border-yellow-600",children:[(0,n.jsxs)("div",{className:"absolute top-0 right-1 flex items-center text-xs text-gray-600 dark:text-gray-400",children:[O,(0,n.jsx)(m.Z,{onClick:()=>{u()},className:"ml-1 cursor-pointer text-red-600",size:16})]}),(0,n.jsx)("textarea",{ref:l,value:F,onChange:function(e){let t=e.target.value;clearTimeout(q.current),q.current=setTimeout(()=>{S(t)},500),Q(t)},style:{fontSize:N},className:"w-full h-full min-h-[200px] p-2 pt-3 border-0 outline-0 resize-none bg-transparent ".concat(R?"animate-pulse":"")})]})]})}),(0,n.jsx)(g,{visible:j,title:"메모를 삭제하시겠습니까?",buttons:[{children:"취소",onClick:v},{children:"삭제",onClick:async()=>{v();try{await f.n.deleteMemo(t),x.Am.success("메모 삭제 성공"),K.invalidateQueries({queryKey:y.a.memoKeys.list()}),K.invalidateQueries({queryKey:y.a.memoKeys.detail(t)}),a.replace(k.routes.root)}catch(e){x.Am.error((0,n.jsxs)(n.Fragment,{children:["메모 삭제 실패:",(0,n.jsx)("br",{}),JSON.stringify(e)]}))}}}],onClose:v})]})}var C=r(7432);function N(e){let{memoId:t,setTitle:r,textareaRef:l}=e,a=(0,s.useRouter)(),{openModal:o,closeModal:c,Modal:u,visible:f}=(0,p.Z)(),{increaseFontSize:y,decreaseFontSize:v,fontSize:g}=b(),{allMemos:j,setMemo:w,deleteMemo:N}=(0,C._)(),H=null==j?void 0:j.find(e=>e.memoId===t),{memoHistories:Y,currentIndex:A,backHistory:T,nextHistory:I,resetHistory:S,pushHistory:_}=z();(0,i.useEffect)(()=>{t>0&&(S(),R(""))},[t,S]);let[D,R]=(0,i.useState)(""),M=D||(null==H?void 0:H.text)||"";(0,i.useEffect)(()=>{M&&(null==r||r(M.split("\n")[0].slice(0,50)))},[M,r]);let E=(0,i.useRef)(),F=(0,i.useRef)();function K(e){R(e),clearTimeout(F.current),F.current=setTimeout(()=>{let r=d()().format("YYYY-MM-DD HH:mm");w({memoId:t,text:e,editedAt:r,createdAt:(null==H?void 0:H.createdAt)||r}),x.Am.success("수정완료",{duration:500})},1500)}let q=H&&d()(H.editedAt||H.createdAt).format("YYYY-MM-DD HH:mm");return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"h-[calc(100dvh-60px-env(safe-area-inset-bottom))] px-[15px] pb-[15px] flex flex-col items-center gap-[10px]",children:[(0,n.jsxs)("div",{className:"flex items-center gap-[10px] pt-[10px]",children:[(0,n.jsx)(h.z,{onClick:y,size:"sm",variant:"secondary",children:"글씨+"}),(0,n.jsx)(h.z,{onClick:v,size:"sm",variant:"secondary",children:"글씨-"}),(0,n.jsx)(h.z,{onClick:()=>{T(),R(Y[A-1]),K(Y[A-1])},size:"sm",variant:"secondary",children:"뒤로"}),(0,n.jsx)(h.z,{onClick:()=>{I(),R(Y[A+1]),K(Y[A+1])},size:"sm",variant:"secondary",children:"앞으로"})]}),(0,n.jsxs)("div",{className:"relative flex-1 min-h-[250px] w-full min-w-[250px] bg-yellow-50 border-2 border-yellow-300 rounded-lg dark:bg-yellow-900 dark:border-yellow-600",children:[(0,n.jsxs)("div",{className:"absolute top-0 right-1 flex items-center text-xs text-gray-600 dark:text-gray-400",children:[q,(0,n.jsx)(m.Z,{onClick:()=>{o()},className:"ml-1 cursor-pointer text-red-600",size:16})]}),(0,n.jsx)("textarea",{ref:l,value:M,onChange:function(e){let t=e.target.value;clearTimeout(E.current),E.current=setTimeout(()=>{_(t)},500),K(t)},style:{fontSize:g},className:"w-full h-full min-h-[200px] p-2 pt-3 border-0 outline-0 resize-none bg-transparent"})]})]}),(0,n.jsx)(u,{visible:f,title:"메모를 삭제하시겠습니까?",buttons:[{children:"취소",onClick:c},{children:"삭제",onClick:()=>{N(t),c(),x.Am.success("메모 삭제 성공"),a.replace(k.routes.root)}}],onClose:c})]})}function H(){let e=(0,s.useRouter)(),t=e.isReady&&Number(e.query.memoId)||0,[r,o]=(0,i.useState)(""),c=(0,i.useRef)(null);return e.isReady?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(a.Z,{title:r,backButtonSize:24,onTitleClick:()=>{var e;return null==c?void 0:null===(e=c.current)||void 0===e?void 0:e.scrollTo(0,0)}}),(0,n.jsx)(l.T,{unauthorizedComponent:(0,n.jsx)(N,{memoId:t,setTitle:o,textareaRef:c}),children:(0,n.jsx)(w,{memoId:t,setTitle:o,textareaRef:c},t)})]}):null}}},function(e){e.O(0,[888,774,179],function(){return e(e.s=3516)}),_N_E=e.O()}]);